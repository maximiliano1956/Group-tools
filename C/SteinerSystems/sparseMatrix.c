#include <stdio.h>

#include "dlx.h"
#include "dlx.c"

int nrows=35;
int ncols=21;
int b=3;

char sparseMatrix[][21] =
	{
		{ 1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
		{ 1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0 },
		{ 1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0 },
		{ 1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0 },
		{ 1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0 },
		{ 0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0 },
		{ 0,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0 },
		{ 0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0 },
		{ 0,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0 },
		{ 0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0 },
		{ 0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0 },
		{ 0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0 },
		{ 0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0 },
		{ 0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0 },
		{ 0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 },
		{ 0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0 },
		{ 0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0 },
		{ 0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0 },
		{ 0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0 },
		{ 0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,0,0 },
		{ 0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0 },
		{ 0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,0 },
		{ 0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,0,0 },
		{ 0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,1,0 },
		{ 0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1 },
		{ 0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,0,0,0,0,0 },
		{ 0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,1,0,0,0,0 },
		{ 0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,1,0,0,0 },
		{ 0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0 },
		{ 0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,1,0 },
		{ 0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1 },
		{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0 },
		{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0 },
		{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1 },
		{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1 }
	};

char bn[][3] = {
	{ 1,2,3 },
	{ 1,2,4 },
	{ 1,2,5 },
	{ 1,2,6 },
	{ 1,2,7 },
	{ 1,3,4 },
	{ 1,3,5 },
	{ 1,3,6 },
	{ 1,3,7 },
	{ 1,4,5 },
	{ 1,4,6 },
	{ 1,4,7 },
	{ 1,5,6 },
	{ 1,5,7 },
	{ 1,6,7 },
	{ 2,3,4 },
	{ 2,3,5 },
	{ 2,3,6 },
	{ 2,3,7 },
	{ 2,4,5 },
	{ 2,4,6 },
	{ 2,4,7 },
	{ 2,5,6 },
	{ 2,5,7 },
	{ 2,6,7 },
	{ 3,4,5 },
	{ 3,4,6 },
	{ 3,4,7 },
	{ 3,5,6 },
	{ 3,5,7 },
	{ 3,6,7 },
	{ 4,5,6 },
	{ 4,5,7 },
	{ 4,6,7 },
	{ 5,6,7 }
};

int cback(int rows_size,int *rows,void *data) {

	for (int i=0;i<rows_size;i++) {
		printf("{");
		for (int j=0;j<b;j++) {
			printf("%2d",bn[rows[i]][j]);
			if (j<b-1)
				printf(",");
			}
		printf("}");
		if (i<rows_size-1)
			printf(",");
	}
	printf("\n");

        return(0);
}


int main()
{

    // Defining result Matrix
    unsigned short resultMatrix[300];

    struct dlx_Node *header;

    // Finding total non-zero values in the sparse matrix (serve per allocare resultMatrix)
    int size=0;
    for (int row=0;row<nrows;row++)
        for (int column=0;column<ncols;column++)
            if (sparseMatrix[row][column]==1)
                size++;

    // Generating result matrix
    int k=0;
    for (int row=0;row<nrows;row++)
        for (int column=0;column<ncols;column++)
            if (sparseMatrix[row][column]==1)
            {
                resultMatrix[k++]=row;
                resultMatrix[k++]=column;
            }

    header=dlx_alloc_sparse(resultMatrix,nrows,ncols,size);
    if (header==NULL) {                     // Test se allocazione ram per algoritmo DLX riuscita
	printf("Ram insufficiente! (dlx_alloc_sparse)\n");
	return(1);
    }

    printf("\n");

    dlx_solve(header,cback,NULL);           // Ricerca tutte le coperture esatte
    dlx_free(header);

    printf("\n");

    return(0);
}
